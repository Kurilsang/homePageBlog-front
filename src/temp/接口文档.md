# 博客系统接口文档

## 目录

- [用户认证接口](#用户认证接口)
- [文章管理接口](#文章管理接口)
- [评论管理接口](#评论管理接口)
- [个人资料接口](#个人资料接口)
- [普通用户接口](#普通用户接口)

## 用户认证接口

### 管理员登录

```
接口：/api/auth/login
方法：POST
传入参数：
  - username: 用户名（字符串，必填）
  - password: 密码（字符串，必填）
返回数据：
  - token: JWT认证令牌（字符串）
  - user: 用户信息（对象）

流程描述：
1. 从 admin 表中查询 username 对应的管理员记录
2. 验证密码是否匹配（使用密码哈希比对）
3. 如果验证通过，生成JWT令牌，包含用户ID和角色信息
4. 将令牌和用户基本信息返回给客户端
5. 如果验证失败，返回401错误
```

### 管理员登出

```
接口：/api/auth/logout
方法：POST
传入参数：无
权限要求：需要认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 将当前的JWT令牌加入黑名单（可选，取决于实现方式）
2. 返回成功状态
```

## 文章管理接口

### 获取文章列表

```
接口：/api/articles
方法：GET
传入参数：
  - page: 当前页码（整数，默认1）
  - pageSize: 每页条数（整数，默认10）
  - search: 搜索关键词（字符串，可选）
  - tag: 标签筛选（字符串，可选）
  - pinned: 是否只获取置顶文章（布尔值，可选）
返回数据：
  - total: 总文章数（整数）
  - articles: 文章数组（数组）
    - id: 文章ID（整数）
    - title: 文章标题（字符串）
    - summary: 文章摘要（字符串）
    - coverImage: 封面图片URL（字符串）
    - date: 发布日期（日期字符串）
    - tag: 文章标签（字符串）
    - isPinned: 是否置顶（布尔值）

流程描述：
1. 从 article 表中查询文章列表
2. 如果有搜索参数，使用 LIKE 查询匹配标题和摘要
3. 如果有标签参数，筛选指定标签的文章
4. 如果请求置顶文章，筛选 is_pinned=true 的文章
5. 根据置顶状态和发布日期排序（置顶优先，同为置顶则按日期降序）
6. 根据分页参数返回指定范围的文章数据
```

### 获取文章详情

```
接口：/api/articles/:id
方法：GET
传入参数：
  - id: 文章ID（路径参数，整数）
返回数据：
  - id: 文章ID（整数）
  - title: 文章标题（字符串）
  - summary: 文章摘要（字符串）
  - content: 文章内容（字符串，HTML格式）
  - coverImage: 封面图片URL（字符串）
  - date: 发布日期（日期字符串）
  - tag: 文章标签（字符串）
  - keywords: 关键词数组（字符串数组）
  - isPinned: 是否置顶（布尔值）

流程描述：
1. 从 article 表中查询指定ID的文章
2. 从 article_keyword 关联表中查询文章关键词
3. 将文章信息和关键词组合后返回
4. 如果文章不存在，返回404错误
```

### 创建文章

```
接口：/api/articles
方法：POST
传入参数：
  - title: 文章标题（字符串，必填）
  - summary: 文章摘要（字符串，必填）
  - content: 文章内容（字符串，必填）
  - coverImage: 封面图片URL（字符串，可选）
  - date: 发布日期（日期字符串，可选，默认当前日期）
  - tag: 文章标签（字符串，可选）
  - keywords: 关键词数组（字符串数组，可选）
  - isPinned: 是否置顶（布尔值，可选，默认false）
权限要求：需要管理员认证
返回数据：
  - id: 新创建的文章ID（整数）
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证请求参数是否合法（标题和内容不能为空）
2. 在 article 表中创建新文章记录
3. 如果提供了关键词，在 article_keyword 关联表中创建关键词关联
4. 返回新创建的文章ID和成功状态
```

### 更新文章

```
接口：/api/articles/:id
方法：PUT
传入参数：
  - id: 文章ID（路径参数，整数）
  - title: 文章标题（字符串，可选）
  - summary: 文章摘要（字符串，可选）
  - content: 文章内容（字符串，可选）
  - coverImage: 封面图片URL（字符串，可选）
  - date: 发布日期（日期字符串，可选）
  - tag: 文章标签（字符串，可选）
  - keywords: 关键词数组（字符串数组，可选）
  - isPinned: 是否置顶（布尔值，可选）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证请求的文章ID是否存在
2. 更新 article 表中的文章记录
3. 如果提供了关键词，先删除原有关联，再创建新的关键词关联
4. 返回操作成功状态
5. 如果文章不存在，返回404错误
```

### 切换文章置顶状态

```
接口：/api/articles/:id/toggle-pin
方法：PATCH
传入参数：
  - id: 文章ID（路径参数，整数）
  - isPinned: 是否置顶（布尔值，必填）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证请求的文章ID是否存在
2. 更新 article 表中文章的 is_pinned 字段
3. 返回操作成功状态
4. 如果文章不存在，返回404错误
```

### 删除文章

```
接口：/api/articles/:id
方法：DELETE
传入参数：
  - id: 文章ID（路径参数，整数）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证请求的文章ID是否存在
2. 删除文章相关的评论（从 comment 表中删除）
3. 删除文章关键词关联（从 article_keyword 表中删除）
4. 删除文章记录（从 article 表中删除）
5. 返回操作成功状态
6. 如果文章不存在，返回404错误
```

## 评论管理接口

### 获取文章评论

```
接口：/api/articles/:id/comments
方法：GET
传入参数：
  - id: 文章ID（路径参数，整数）
返回数据：
  - comments: 评论数组（数组）
    - id: 评论ID（整数）
    - articleId: 文章ID（整数）
    - parentId: 父评论ID（整数，可能为null）
    - author: 评论作者（字符串）
    - avatar: 头像URL（字符串）
    - content: 评论内容（字符串）
    - date: 评论日期（日期字符串）
    - isUser: 是否为注册用户（布尔值）

流程描述：
1. 从 comment 表中查询指定文章ID的评论
2. 对于非管理员请求，只返回状态为 'approved' 的评论
3. 标记评论是否来自注册用户（user_id是否为null）
4. 按照日期降序排序后返回评论数据
```

### 添加评论

```
接口：/api/comments
方法：POST
传入参数：
  - articleId: 文章ID（整数，必填）
  - parentId: 父评论ID（整数，可选，回复评论时填写）
  - content: 评论内容（字符串，必填）
  - author: 评论作者（字符串，未登录用户必填）
  - avatar: 头像URL（字符串，未登录用户可选）
返回数据：
  - id: 新创建的评论ID（整数）
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证文章ID是否存在
2. 如果提供了父评论ID，验证父评论是否存在
3. 检查用户认证状态：
   a. 已登录用户：从令牌中获取用户ID和信息
   b. 未登录用户：使用提供的author和avatar
4. 在 comment 表中创建新评论记录：
   a. 已登录用户：设置user_id，使用用户表中的nickname作为author
   b. 未登录用户：user_id为null，使用提供的author
5. 设置评论状态为 'pending'
6. 返回新创建的评论ID和成功状态
```

### 获取所有评论（管理员）

```
接口：/api/admin/comments
方法：GET
传入参数：
  - page: 当前页码（整数，默认1）
  - pageSize: 每页条数（整数，默认10）
  - status: 评论状态筛选（字符串，可选：'all', 'pending', 'approved', 'rejected'）
  - search: 搜索关键词（字符串，可选）
  - userType: 用户类型筛选（字符串，可选：'all', 'registered', 'anonymous'）
权限要求：需要管理员认证
返回数据：
  - total: 总评论数（整数）
  - comments: 评论数组（数组）
    - id: 评论ID（整数）
    - articleId: 文章ID（整数）
    - articleTitle: 文章标题（字符串）
    - parentId: 父评论ID（整数，可能为null）
    - parentAuthor: 父评论作者（字符串，当parentId不为null时有值）
    - userId: 用户ID（整数，可能为null）
    - userInfo: 用户信息（对象，当userId不为null时有值）
    - author: 评论作者（字符串）
    - avatar: 头像URL（字符串）
    - content: 评论内容（字符串）
    - date: 评论日期（日期字符串）
    - status: 评论状态（字符串）
    - isRegistered: 是否为注册用户（布尔值）

流程描述：
1. 从 comment 表中查询评论列表
2. 关联 article 表获取文章标题
3. 关联 user 表获取用户信息
4. 如果有状态筛选，筛选指定状态的评论
5. 如果有用户类型筛选，筛选指定类型的评论（注册用户或匿名用户）
6. 如果有搜索参数，使用 LIKE 查询匹配评论内容和作者
7. 根据日期降序排序
8. 根据分页参数返回指定范围的评论数据
```

### 更新评论状态

```
接口：/api/admin/comments/:id/status
方法：PATCH
传入参数：
  - id: 评论ID（路径参数，整数）
  - status: 新状态（字符串，必填：'approved' 或 'rejected'）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证评论ID是否存在
2. 更新 comment 表中评论的 status 字段
3. 返回操作成功状态
4. 如果评论不存在，返回404错误
```

### 删除评论

```
接口：/api/admin/comments/:id
方法：DELETE
传入参数：
  - id: 评论ID（路径参数，整数）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证评论ID是否存在
2. 将该评论作为父评论的回复评论也一并删除
3. 从 comment 表中删除评论记录
4. 返回操作成功状态
5. 如果评论不存在，返回404错误
```

## 个人资料接口

### 获取个人资料

```
接口：/api/profile
方法：GET
传入参数：无
返回数据：
  - avatar: 头像URL（字符串）
  - title: 标题/昵称（字符串）
  - description: 个人描述（字符串）

流程描述：
1. 从 profile 表中查询唯一的个人资料记录
2. 返回个人资料数据
```

### 更新个人资料

```
接口：/api/profile
方法：PUT
传入参数：
  - avatar: 头像URL（字符串，可选）
  - title: 标题/昵称（字符串，可选）
  - description: 个人描述（字符串，可选）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 更新 profile 表中的个人资料记录
2. 如果表中没有记录，则创建一条新记录
3. 返回操作成功状态
```

## 普通用户接口

### 用户注册

```
接口：/api/users/register
方法：POST
传入参数：
  - username: 用户名（字符串，必填）
  - password: 密码（字符串，必填）
  - nickname: 昵称（字符串，必填）
  - email: 电子邮件（字符串，可选）
返回数据：
  - success: 操作是否成功（布尔值）
  - message: 操作结果消息（字符串）

流程描述：
1. 验证用户名、昵称、密码是否符合规则（长度、格式等）
2. 检查用户名和邮箱是否已存在
3. 对密码进行哈希处理
4. 在 user 表中创建新用户记录
5. 返回注册结果
```

### 用户登录

```
接口：/api/users/login
方法：POST
传入参数：
  - username: 用户名（字符串，必填）
  - password: 密码（字符串，必填）
返回数据：
  - token: JWT认证令牌（字符串）
  - user: 用户基本信息（对象，不包含敏感信息）
    - id: 用户ID
    - username: 用户名
    - nickname: 昵称
    - avatar: 头像URL

流程描述：
1. 从 user 表中查询 username 对应的用户记录
2. 验证密码是否匹配（使用密码哈希比对）
3. 如果验证通过，生成JWT令牌，包含用户ID和角色信息
4. 更新用户的最后登录时间
5. 将令牌和用户基本信息返回给客户端
6. 如果验证失败，返回401错误
```

### 获取用户信息

```
接口：/api/users/profile
方法：GET
传入参数：无
权限要求：需要用户认证
返回数据：
  - id: 用户ID（整数）
  - username: 用户名（字符串）
  - nickname: 昵称（字符串）
  - email: 电子邮件（字符串）
  - avatar: 头像URL（字符串）
  - createdAt: 注册时间（日期字符串）

流程描述：
1. 从认证令牌中获取用户ID
2. 从 user 表中查询用户信息
3. 返回非敏感的用户信息
```

### 更新用户信息

```
接口：/api/users/profile
方法：PUT
传入参数：
  - nickname: 昵称（字符串，可选）
  - email: 电子邮件（字符串，可选）
  - avatar: 头像URL（字符串，可选）
权限要求：需要用户认证
返回数据：
  - success: 操作是否成功（布尔值）
  - user: 更新后的用户信息（对象）

流程描述：
1. 从认证令牌中获取用户ID
2. 验证请求参数（如邮箱格式等）
3. 更新 user 表中的用户信息
4. 返回更新后的用户信息
```

### 修改密码

```
接口：/api/users/password
方法：PUT
传入参数：
  - currentPassword: 当前密码（字符串，必填）
  - newPassword: 新密码（字符串，必填）
权限要求：需要用户认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 从认证令牌中获取用户ID
2. 验证当前密码是否正确
3. 验证新密码是否符合安全规则
4. 对新密码进行哈希处理
5. 更新 user 表中的密码字段
6. 返回操作结果
```

### 用户注销

```
接口：/api/users/logout
方法：POST
传入参数：无
权限要求：需要用户认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 将当前的JWT令牌加入黑名单（可选，取决于实现方式）
2. 返回成功状态
```

### 获取用户评论列表

```
接口：/api/users/comments
方法：GET
传入参数：
  - page: 当前页码（整数，默认1）
  - pageSize: 每页条数（整数，默认10）
权限要求：需要用户认证
返回数据：
  - total: 总评论数（整数）
  - comments: 评论数组（数组）
    - id: 评论ID（整数）
    - articleId: 文章ID（整数）
    - articleTitle: 文章标题（字符串）
    - content: 评论内容（字符串）
    - date: 评论日期（日期字符串）
    - status: 评论状态（字符串）

流程描述：
1. 从认证令牌中获取用户ID
2. 从 comment 表中查询该用户发表的所有评论
3. 关联 article 表获取文章标题
4. 按照日期降序排序
5. 根据分页参数返回指定范围的评论数据
```

### 用户列表管理（管理员）

```
接口：/api/admin/users
方法：GET
传入参数：
  - page: 当前页码（整数，默认1）
  - pageSize: 每页条数（整数，默认10）
  - status: 状态筛选（字符串，可选：'all', 'active', 'inactive', 'banned'）
  - search: 搜索关键词（字符串，可选）
权限要求：需要管理员认证
返回数据：
  - total: 总用户数（整数）
  - users: 用户数组（数组）
    - id: 用户ID（整数）
    - username: 用户名（字符串）
    - nickname: 昵称（字符串）
    - email: 电子邮件（字符串）
    - avatar: 头像URL（字符串）
    - status: 用户状态（字符串）
    - lastLogin: 最后登录时间（日期字符串）
    - createdAt: 注册时间（日期字符串）
    - commentCount: 评论数量（整数）

流程描述：
1. 从 user 表中查询用户列表
2. 关联 comment 表计算每个用户的评论数量
3. 如果有状态筛选，筛选指定状态的用户
4. 如果有搜索参数，使用 LIKE 查询匹配用户名、昵称或邮箱
5. 根据注册时间降序排序
6. 根据分页参数返回指定范围的用户数据
```

### 用户状态管理（管理员）

```
接口：/api/admin/users/:id/status
方法：PATCH
传入参数：
  - id: 用户ID（路径参数，整数）
  - status: 新状态（字符串，必填：'active', 'inactive', 'banned'）
权限要求：需要管理员认证
返回数据：
  - success: 操作是否成功（布尔值）

流程描述：
1. 验证用户ID是否存在
2. 更新 user 表中用户的 status 字段
3. 返回操作成功状态
4. 如果用户不存在，返回404错误
``` 